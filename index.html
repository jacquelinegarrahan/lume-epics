
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://lume-epics.github.io/" rel="canonical"/>
<link href="assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-5.4.0" name="generator"/>
<title>lume-epics</title>
<link href="assets/stylesheets/main.fe0cca5b.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#lume-epics">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="lume-epics" class="md-header-nav__button md-logo" href="https://lume-epics.github.io/" title="lume-epics">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            lume-epics
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Overview
            
          </span>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/slaclab/lume-epics/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="lume-epics" class="md-nav__button md-logo" href="https://lume-epics.github.io/" title="lume-epics">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    lume-epics
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/slaclab/lume-epics/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Overview
        <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path></svg>
</span>
</label>
<a class="md-nav__link md-nav__link--active" href="." title="Overview">
      Overview
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-development">
    Model Development
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-associations">
    Variable Associations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#server">
    Server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#client">
    Client
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Install/" title="Install">
      Install
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      Tutorial
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Tutorial" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Tutorial
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="BokehServer/" title="Bokeh Server">
      Bokeh Server
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Jupyter/" title="Jupyter Notebook Demo">
      Jupyter Notebook Demo
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Documentation
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Documentation" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-4">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Documentation
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="Layout/" title="Layout">
      Layout
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" id="nav-4-2" type="checkbox"/>
<label class="md-nav__link" for="nav-4-2">
      Client
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Client" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="nav-4-2">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Client
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="Controller/" title="Controller">
      Controller
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Monitors/" title="Monitors">
      Monitors
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Widgets/" title="Widgets">
      Widgets
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Model/" title="Model">
      Model
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="Server/" title="Server">
      Server
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-development">
    Model Development
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-associations">
    Variable Associations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#server">
    Server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#client">
    Client
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/slaclab/lume-epics/edit/master/docs/index.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="lume-epics">lume-epics</h1>
<p>Lume-epics is a dedicated API for serving and interacting with online models using EPICS process variables. </p>
<h2 id="model-development">Model Development</h2>
<p>Model input and output variables are represented by <a href="https://github.com/slaclab/lume-model">lume-model</a> variable representations. These variables enforce the minimal data requirements necessary for serving EPICS process variables associated with an online model. Lume-model defines two variable types: scalar and image. Scalar variables hold float values while image variables hold two dimensional arrays. The lume-epics server must be instantiated with a user defined class holding all methods necessary for model execution.</p>
<p>Lume-model also defines a SurrogateModel base class to enforce the defined class's compatability with the lume-epics server. The primary function of this base class is to force the implementation of an evaluate method. This method must accept a list of lume-model input variables, execute the model, and return a list of output variables. Input variables and output variables must be defined as class attributes. They may be defined directly as class attributes or assigned in <strong>init</strong>.</p>
<p>Below is an example of an model defined using class attributes.</p>
<pre><code>from lume_epics.model import SurrogateModel
from lume_model.variables import ScalarInputVariable, ImageOutputVariable

class ExampleModel(SurrogateModel):
    input_variables = {
        "input1": ScalarInputVariable(
                    name="input1", 
                    default=1, 
                    range=[0, 256]
                ),
        "input2": ScalarInputVariable(
                    name="input2", 
                    default=2, 
                    range=[0, 256]
                ),
    }

    output_variables = {
        "output1": ImageOutputVariable(
                    name="output1", 
                    axis_labels=["value_1", "value_2"], 
                    axis_units=["mm", "mm"], 
                    x_min=0,
                    x_max=50, 
                    y_min=0, 
                    y_max=50
        )
    }

    def evaluate(self, input_variables):
        self.output_variables["output1"].value = np.random.uniform(
            input_variables["input1"].value, # lower dist bound
            input_variables["input2"].value, # upper dist bound
            (50,50)
        ) #shape


        return list(self.output_variables.values()
</code></pre>
<h2 id="variable-associations">Variable Associations</h2>
<p>In the case that image variable axis bounds are dictated by the output of other variables, associations can be created between the bound scalar variable and the axis values of the image variables. This is accomplished by defining the <code>parent</code> attribute on the bound variables and assigning the corresponding variable name to the bound variable attributes of the image variable.</p>
<p>For example:</p>
<pre><code>x_min = ScalarOutputVariable(
            name="x_min"
        )

x_max = ScalarOutputVariable(
            name="x_max"
        )

y_min = ScalarOutputVariable(
            name="y_min"
        ),
y_max = ScalarOutputVariable(
            name="y_max"
        )

image_input = ImageOutputVariable(
    name="output1", 
    axis_labels=["value_1", "value_2"], 
    axis_units=["mm", "mm"], 
    x_min_variable="x_min",
    x_max_variable="x_max", 
    y_min_variable="y_min", 
    y_max_variable="y_max"
)
</code></pre>
<h2 id="server">Server</h2>
<p>The EPICS server requires a model class, input variables, output variables, and a prefix for intantiation. By default, the server uses both the pvAccess and Channel Access protocols when serving the EPICS process variables.An optional keyword argument allows the server to be started using a single protocol (<code>protocols=["pva"]</code> for pvAccess, <code>protocols=["ca"]</code> for Channel Access). Once instantiated, the server is started using the <code>Server.start()</code> method, which has an optional monitor keyword argument, <code>monitor</code>, that controls thread execution. When <code>monitor=True</code>, the server is run in the main thread and may be stopped using keyboard interrupt (<code>Ctr+C</code>). If using <code>monitor=False</code>, the server can be stopped manually using the <code>Server.stop()</code> method. </p>
<pre><code>from lume_epics.epics_server import Server

prefix = "test"
server = Server(
            DemoModel, 
            DemoModel.input_variables, 
            DemoModel.output_variables, 
            prefix
        )
# monitor = False does not loop in main thread and can be terminated 
# with server.stop()
server.start(monitor=True)
# Runs until keyboard interrupt.
</code></pre>
<h2 id="client">Client</h2>
<p>A number of EPICS compatable widgets are included in lume-epics. Each widget accepts a controller used to monitor EPICS process variables. The controller is then used by a widget-specific monitor, which is responsible for formatting outputs of EPICS values into formats usable by the widget. There are currently slider, value table, image, and striptool widgets; however, more widgets could be configured using the base monitor and controller classes included in <code>lume_epics/client/</code>.</p>
<p>The controller fetches variables using a configurable protocol defined on instantiation.Variable assigment is done over both pvAccess and Channel Access protocols by default. The controller must be configured to reflect the corresponding server. If using a single protocol for serving, the controller must be set up to fetch using that protocol and the excluded protocol must be disabled manually using the appropriate <code>set_pva=False</code>, <code>set_ca=False</code> key word argument.</p>
<p>The same variables and prefix used for instantiating the server must be used for building the client tooling. For the purpose of separability, these variables should be saved during model development and loaded on the client side. <code>lume-model.utils</code> contains utility functions for saving variables. </p>
<p>Example of client tooling:</p>
<pre><code>from lume_model.variables import ScalarInputVariable, ScalarOutputVariable, ImageOutputVariable
from lume_epics.client.controller import Controller
from lume_epics.client.widgets.plots import ImagePlot, Striptool
from lume_epics.client.widgets.tables import ValueTable
from lume_epics.client.widgets.controls import build_sliders


input_variables = {
    "input1": ScalarInputVariable(
                name="input1", 
                value=1, 
                default=1, 
                range=[0.0, 5.0]
            ),
    "input2": ScalarInputVariable(
                name="input2", 
                value=2, 
                default=2, 
                range=[0.0, 5.0]
            ),
}

output_variables = {
    "output1": ScalarOutputVariable(name="output1"),
    "output2": ScalarOutputVariable(name="output2"),
    "output3": ImageOutputVariable(
        name="output3",
        default=np.array([[1, 2,], [3, 4]]),
        axis_labels=["count_1", "count_2"],
        x_min=0,
        y_min=0,
        x_max=5,
        y_max=5,
    ),
}

prefix = "test"

# initialize controller to use pvAccess for variable gets
controller = Controller("pva")

# build sliders for the command process variable database
sliders = build_sliders(
            input_variables["input1], 
            input_variables["input2], 
            controller, 
            prefix
        )

# build value table
value_table = ValueTable(
                [output_variables["output1], output_variables["output2], 
                controller, 
                prefix
            )

# build image plot
value_table = ImagePlot([output_variables["output3]], controller, prefix)

# build striptool
striptool = Striptool(
                [output_variables["output1], output_variables["output2], 
                controller, 
                prefix
            )


# Finally, terminate the controller
controller.close()
</code></pre>
<p>To serve the widgets using bokeh, you must include their bokeh items in the document formatting. These are stored as attributes on the widget. Tutorials for serving these directly using the bokeh server and within Jupyter notebooks are included in Tutorials.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--next" href="Install/" rel="next" title="Install">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Install
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="assets/javascripts/vendor.d710d30a.min.js"></script>
<script src="assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>